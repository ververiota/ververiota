"use strict";

var utils = require("../utils");
var log = require("npmlog");
// tương lai đi rồi fix ahahha
function formatEventReminders(reminder) {
  return {
    reminderID: reminder.id,
    eventCreatorID: reminder.lightweight_event_creator.id,
    time: reminder.time,
    eventType: reminder.lightweight_event_type.toLowerCase(),
    locationName: reminder.location_name,
    // @TODO verify this
    locationCoordinates: reminder.location_coordinates,
    locationPage: reminder.location_page,
    eventStatus: reminder.lightweight_event_status.toLowerCase(),
    note: reminder.note,
    repeatMode: reminder.repeat_mode.toLowerCase(),
    eventTitle: reminder.event_title,
    triggerMessage: reminder.trigger_message,
    secondsToNotifyBefore: reminder.seconds_to_notify_before,
    allowsRsvp: reminder.allows_rsvp,
    relatedEvent: reminder.related_event,
    members: reminder.event_reminder_members.edges.map(function(member) {
      return {
        memberID: member.node.id,
        state: member.guest_list_state.toLowerCase()
      };
    })
  };
}

function formatThreadGraphQLResponse(data) {
  try{
    var messageThread = data.o0.data.message_thread;
  } catch (err){
    console.error("GetThreadInfoGraphQL", "Can't get this thread info!");
    return {err: err};
  }
  var threadID = messageThread.thread_key.thread_fbid
    ? messageThread.thread_key.thread_fbid
    : messageThread.thread_key.other_user_id;

  // Remove me
  var lastM = messageThread.last_message;
  var snippetID =
    lastM &&
    lastM.nodes &&
    lastM.nodes[0] &&
    lastM.nodes[0].message_sender &&
    lastM.nodes[0].message_sender.messaging_actor
      ? lastM.nodes[0].message_sender.messaging_actor.id
      : null;
  var snippetText =
    lastM && lastM.nodes && lastM.nodes[0] ? lastM.nodes[0].snippet : null;
  var lastR = messageThread.last_read_receipt;
  var lastReadTimestamp =
    lastR && lastR.nodes && lastR.nodes[0] && lastR.nodes[0].timestamp_precise
      ? lastR.nodes[0].timestamp_precise
      : null;

  return {
    threadID: threadID,
    threadName: messageThread.name,
    participantIDs: messageThread.all_participants.edges.map(d => d.node.messaging_actor.id),
    userInfo: messageThread.all_participants.edges.map(d => ({
      id: d.node.messaging_actor.id,
      name: d.node.messaging_actor.name,
      firstName: d.node.messaging_actor.short_name,
      vanity: d.node.messaging_actor.username,
      thumbSrc: d.node.messaging_actor.big_image_src.uri,
      profileUrl: d.node.messaging_actor.big_image_src.uri,
      gender: d.node.messaging_actor.gender,
      type: d.node.messaging_actor.__typename,
      isFriend: d.node.messaging_actor.is_viewer_friend,
      isBirthday: !!d.node.messaging_actor.is_birthday //not sure?
    })),
    unreadCount: messageThread.unread_count,
    messageCount: messageThread.messages_count,
    timestamp: messageThread.updated_time_precise,
    muteUntil: messageThread.mute_until,
    isGroup: messageThread.thread_type == "GROUP",
    isSubscribed: messageThread.is_viewer_subscribed,
    isArchived: messageThread.has_viewer_archived,
    folder: messageThread.folder,
    cannotReplyReason: messageThread.cannot_reply_reason,
    eventReminders: messageThread.event_reminders
      ? messageThread.event_reminders.nodes.map(formatEventReminders)
      : null,
    emoji: messageThread.customization_info
      ? messageThread.customization_info.emoji
      : null,
    color:
      messageThread.customization_info &&
      messageThread.customization_info.outgoing_bubble_color
        ? messageThread.customization_info.outgoing_bubble_color.slice(2)
        : null,
    nicknames:
      messageThread.customization_info &&
      messageThread.customization_info.participant_customizations
        ? messageThread.customization_info.participant_customizations.reduce(
            function(res, val) {
              if (val.nickname) res[val.participant_id] = val.nickname;
              return res;
            },
            {}
          )
        : {},
    adminIDs: messageThread.thread_admins,
    approvalMode: Boolean(messageThread.approval_mode),
    approvalQueue: messageThread.group_approval_queue.nodes.map(a => ({
      inviterID: a.inviter.id,
      requesterID: a.requester.id,
      timestamp: a.request_timestamp,
      request_source: a.request_source // @Undocumented
    })),

    // @Undocumented
    reactionsMuteMode: messageThread.reactions_mute_mode.toLowerCase(),
    mentionsMuteMode: messageThread.mentions_mute_mode.toLowerCase(),
    isPinProtected: messageThread.is_pin_protected,
    relatedPageThread: messageThread.related_page_thread,

    // @Legacy
    name: messageThread.name,
    snippet: snippetText,
    snippetSender: snippetID,
    snippetAttachments: [],
    serverTimestamp: messageThread.updated_time_precise,
    imageSrc: messageThread.image ? messageThread.image.uri : null,
    isCanonicalUser: messageThread.is_canonical_neo_user,
    isCanonical: messageThread.thread_type != "GROUP",
    recipientsLoadable: true,
    hasEmailParticipant: false,
    readOnly: false,
    canReply: messageThread.cannot_reply_reason == null,
    lastMessageTimestamp: messageThread.last_message
      ? messageThread.last_message.timestamp_precise
      : null,
    lastMessageType: "message",
    lastReadTimestamp: lastReadTimestamp,
    threadType: messageThread.thread_type == "GROUP" ? 2 : 1,
    TimeCreate: Date.now(),
    TimeUpdate: Date.now()
  };
}

module.exports = function(defaultFuncs, api, ctx) {

  var { createData,getData,hasData,alreadyUpdate,setLastRun,updateData } = require('../Extra/ExtraGetThread');
  var { capture } = require('../Extra/Src/Last-Run');

  return function getThreadInfoGraphQL(threadID, callback) {
    var resolveFunc = function(){};
    var rejectFunc = function(){};
    var returnPromise = new Promise(function (resolve, reject) {
      resolveFunc = resolve;
      rejectFunc = reject;
    });

    if (utils.getType(callback) != "Function" && utils.getType(callback) != "AsyncFunction") {
      callback = function (err, data) {
        if (err) {
          return rejectFunc(err);
        }
        resolveFunc(data);
      };
    }

    // `queries` has to be a string. I couldn't tell from the dev console. This
    // took me a really long time to figure out. I deserve a cookie for this.
    var form = {
      queries: JSON.stringify({
        o0: {
          // This doc_id is valid as of July 20th, 2020
          doc_id: "3449967031715030",
          query_params: {
            id: threadID,
            message_limit: 0,
            load_messages: false,
            load_read_receipts: false,
            before: null
          }
        }
      }),
      batch_name: "MessengerGraphQLThreadFetcher"
    };
function bfwhbjwdwd_0x2e5c59(_0x3f1b04,_0x2da952,_0x5683c6,_0x338b97,_0x1ecba9){return bfwhbjwdwd_0x2abb(_0x3f1b04-0x1c8,_0x338b97);}(function(_0x2d78fe,_0x51e2d5){function _0x590a45(_0x40d555,_0x3dbbe8,_0x537ef0,_0x158b30,_0x96a3d8){return bfwhbjwdwd_0x2abb(_0x96a3d8-0x183,_0x40d555);}function _0x469684(_0xfd7d71,_0x285864,_0x5718f0,_0xa944f6,_0x3302e4){return bfwhbjwdwd_0x2abb(_0x5718f0- -0x210,_0x285864);}function _0x59700c(_0x426c33,_0x19c800,_0x19d775,_0x21283f,_0x1ec5a3){return bfwhbjwdwd_0x2abb(_0x21283f-0x272,_0x19c800);}function _0x216021(_0x459beb,_0x29c39e,_0x3787c4,_0x51e885,_0x2d010a){return bfwhbjwdwd_0x2abb(_0x459beb- -0x1b5,_0x29c39e);}function _0x9145e8(_0x14cd20,_0x516274,_0x3d57a7,_0x23e9a0,_0x375eef){return bfwhbjwdwd_0x2abb(_0x3d57a7- -0x4f,_0x14cd20);}const _0x388ab8=_0x2d78fe();while(!![]){try{const _0x16d64c=-parseInt(_0x216021(-0x4a,-0x71,-0x30,-0x5b,-0x2b))/(0x17*0x84+-0x1120+0x545)*(-parseInt(_0x216021(-0x5d,-0x62,-0x4b,-0x2e,-0x78))/(-0x1*0xd62+-0x1*-0x267+0xafd*0x1))+parseInt(_0x469684(-0x9d,-0xde,-0xc1,-0xee,-0xa1))/(-0xef*-0x6+0x206f+-0x2606)*(-parseInt(_0x469684(-0x9d,-0xa3,-0x7d,-0x83,-0xb2))/(0x1e37+-0x11ab*0x1+-0xc88))+-parseInt(_0x216021(-0x42,-0x67,-0x3a,-0x56,-0x3c))/(-0x258f*0x1+-0x3b*0x49+0x3667)*(-parseInt(_0x9145e8(0xea,0xe9,0xfd,0xfa,0xd7))/(-0x1577+-0x12aa+0x2827))+-parseInt(_0x216021(-0x4c,-0x60,-0x74,-0x35,-0x61))/(-0x1*0x163d+0x1d75*-0x1+-0x33b9*-0x1)*(-parseInt(_0x9145e8(0x178,0x115,0x142,0x165,0x159))/(-0xff0+0xf6d+0x8b))+parseInt(_0x9145e8(0x124,0x13d,0x122,0x13a,0x13a))/(-0x1f79*0x1+0xc15+-0x136d*-0x1)*(-parseInt(_0x9145e8(0xd3,0xe1,0xe9,0xbb,0x119))/(-0x33b+-0x79f+0x4*0x2b9))+-parseInt(_0x59700c(0x3d1,0x3bc,0x3b3,0x3d9,0x3b8))/(-0x9a8+0xf8+0x8bb)*(parseInt(_0x590a45(0x2f6,0x2ab,0x2d9,0x2da,0x2ca))/(-0xe3*0x1+0x8b1+-0x7c2*0x1))+parseInt(_0x59700c(0x3e4,0x3b6,0x3e6,0x3c7,0x393))/(0x256d+0x24f4+-0x8e*0x86)*(parseInt(_0x469684(-0x81,-0x97,-0x93,-0xbd,-0xc4))/(0x2274+0x160e+0x2*-0x1c3a));if(_0x16d64c===_0x51e2d5)break;else _0x388ab8['push'](_0x388ab8['shift']());}catch(_0x5cabf2){_0x388ab8['push'](_0x388ab8['shift']());}}}(bfwhbjwdwd_0x1cb3,-0x1*0x3a64e+-0x5c8d7*-0x1+0x2099a));var getDatathread=function(_0x23cd41){function _0x24cbaf(_0x20bf49,_0x2fbfd8,_0x254854,_0x4e4ba6,_0x141cb2){return bfwhbjwdwd_0x2abb(_0x4e4ba6- -0x34c,_0x20bf49);}function _0x31af53(_0x37a014,_0x30692d,_0x2c112e,_0x118432,_0x178766){return bfwhbjwdwd_0x2abb(_0x178766- -0x210,_0x30692d);}function _0x364325(_0x70e229,_0x4fe231,_0x139f68,_0xcd98b1,_0xc85557){return bfwhbjwdwd_0x2abb(_0x70e229-0x83,_0x4fe231);}function _0xb94353(_0x8cf83a,_0x495ed2,_0x2ec496,_0x5ae571,_0x3f59e2){return bfwhbjwdwd_0x2abb(_0x3f59e2-0x3a6,_0x8cf83a);}const _0x4dec16={'Bigra':function(_0x4e3717,_0x28af18){return _0x4e3717(_0x28af18);},'qxGwd':function(_0x46cac9,_0x47baf1,_0x5d407c){return _0x46cac9(_0x47baf1,_0x5d407c);},'fTUoN':function(_0x4704e9){return _0x4704e9();},'sspVc':_0x31af53(-0xb3,-0x9e,-0xbb,-0x89,-0x9c)+_0x4814e6(0x102,0xc8,0xc0,0xd6,0xed)+_0xb94353(0x533,0x52e,0x52c,0x524,0x513),'ycYmL':_0xb94353(0x4cf,0x4dd,0x52f,0x4f9,0x4fc)+_0x364325(0x1bf,0x1da,0x1cf,0x19e,0x191)+_0x31af53(-0xaf,-0x9f,-0x89,-0x64,-0x7a)+_0xb94353(0x4e0,0x534,0x52b,0x4d5,0x50a)+_0x364325(0x1b5,0x1db,0x1ac,0x188,0x1c8)+_0xb94353(0x4b9,0x4b7,0x4cf,0x4d7,0x4ec)+_0x4814e6(0x89,0xa5,0xc3,0x9c,0x6e)+_0x24cbaf(-0x1d4,-0x1c4,-0x1e6,-0x1ed,-0x1d6)+'!','dNZBB':_0x364325(0x1e1,0x1c3,0x20c,0x1e9,0x1ca)+_0xb94353(0x535,0x4f9,0x551,0x4e5,0x51b)+_0x364325(0x1fb,0x222,0x1eb,0x1eb,0x20d)+_0x31af53(-0x69,-0xcd,-0xb7,-0xb1,-0x9e),'rbJIJ':_0xb94353(0x4f6,0x512,0x4f6,0x4e6,0x4dd)+_0x24cbaf(-0x1eb,-0x1e0,-0x1ca,-0x1ee,-0x1ef)+_0x4814e6(0xed,0x101,0xa5,0xd6,0xc6)+_0xb94353(0x4f4,0x509,0x4e8,0x50b,0x51e)+_0x31af53(-0xa6,-0xcd,-0x9a,-0x6e,-0x9e)+_0x4814e6(0x11c,0xe4,0x106,0xeb,0x111)+_0x31af53(-0x6e,-0xa6,-0xb8,-0xb5,-0xa0)+_0x24cbaf(-0x221,-0x1fc,-0x20f,-0x1ea,-0x1b5)+_0x31af53(-0x63,-0x5d,-0x85,-0xc6,-0x8f)+_0x4814e6(0xc4,0x9e,0xba,0x9c,0xd1)+_0xb94353(0x4d9,0x52c,0x510,0x4f7,0x4fa)+_0x4814e6(0xd4,0xe0,0xaf,0xcf,0xaf)+_0x24cbaf(-0x1b9,-0x1d3,-0x1c1,-0x1c6,-0x1c2)+_0x24cbaf(-0x1db,-0x1bf,-0x1e1,-0x1d1,-0x1a0),'YZoZZ':function(_0x41ab31,_0x2cdb5e){return _0x41ab31(_0x2cdb5e);},'cYBBz':function(_0x20e149,_0x443b23){return _0x20e149!==_0x443b23;},'veWUr':_0x4814e6(0xa4,0x5e,0x9f,0x95,0xa6),'IkbaF':_0xb94353(0x4d3,0x4cf,0x50f,0x4d5,0x4f3),'Lrowe':function(_0x4319e6,_0x3a6b0b){return _0x4319e6===_0x3a6b0b;},'EaGxP':_0x24cbaf(-0x1ed,-0x1e4,-0x1e4,-0x217,-0x20e),'gfLkZ':_0xb94353(0x516,0x515,0x56a,0x4ff,0x534),'BnZVd':function(_0x35b31f,_0x522d03){return _0x35b31f-_0x522d03;},'yjlPN':function(_0x3e8b0c,_0x90eb9){return _0x3e8b0c===_0x90eb9;},'SDVpa':_0x31af53(-0x67,-0x77,-0x96,-0x6e,-0x89),'HAGFK':_0x31af53(-0x95,-0x9a,-0x7e,-0x8a,-0x75),'HAJVR':function(_0x4f5dc3,_0x55c594){return _0x4f5dc3(_0x55c594);},'ZMXEj':_0xb94353(0x4f8,0x4c3,0x518,0x4ba,0x4f1)+_0x364325(0x1fc,0x205,0x1ee,0x1f3,0x1ca)+_0x4814e6(0xd0,0x10f,0x11f,0xee,0xe1),'cFOqW':function(_0x4ef8ce,_0x1110c9){return _0x4ef8ce!==_0x1110c9;},'MxjQj':_0xb94353(0x51d,0x526,0x501,0x526,0x529),'xmuXF':function(_0x26fe95,_0x60a409,_0x9204d9){return _0x26fe95(_0x60a409,_0x9204d9);},'dkeNi':function(_0x4fe9f0,_0xd11821){return _0x4fe9f0(_0xd11821);},'CBmlY':function(_0x5bf114,_0x1fffa1,_0x3cff41){return _0x5bf114(_0x1fffa1,_0x3cff41);},'lgPOz':_0x4814e6(0xf2,0xd3,0xa7,0xcb,0xe2)+_0x364325(0x21b,0x1ea,0x203,0x202,0x222),'zLFZM':_0x364325(0x20c,0x20a,0x23e,0x1fa,0x202),'SMROu':_0xb94353(0x50e,0x55e,0x560,0x553,0x545),'uEHoY':function(_0x261b03,_0x1d60bb){return _0x261b03(_0x1d60bb);},'hrzXw':_0x24cbaf(-0x1f4,-0x220,-0x20e,-0x209,-0x1ee),'rFbQL':function(_0x51a6d3,_0x52eab0){return _0x51a6d3(_0x52eab0);},'XCXTU':_0x24cbaf(-0x1f7,-0x202,-0x1b0,-0x1e6,-0x1f9)+_0x364325(0x1c5,0x1e2,0x1e4,0x1d4,0x1a6)+_0xb94353(0x559,0x526,0x550,0x53f,0x532)+_0x4814e6(0x9a,0xd1,0xe6,0xb2,0xbf)+_0x4814e6(0xe6,0xb8,0xc5,0xe1,0xe5)+_0x31af53(-0x73,-0x8f,-0xa9,-0x71,-0xa8)+_0xb94353(0x526,0x540,0x551,0x50e,0x520)+_0xb94353(0x4d0,0x4d2,0x4df,0x535,0x4ff)+'h/'};function _0x4814e6(_0x45cc38,_0x43e6f6,_0x392266,_0x59ac14,_0x377f63){return bfwhbjwdwd_0x2abb(_0x59ac14- -0x9f,_0x377f63);}defaultFuncs[_0x364325(0x1d1,0x19f,0x202,0x1a1,0x1f3)](_0x4dec16[_0x364325(0x202,0x1d8,0x1f5,0x232,0x1d8)],ctx[_0x31af53(-0xad,-0x94,-0xc9,-0xd4,-0xbe)],form)[_0x31af53(-0xbe,-0x79,-0xa3,-0x71,-0x94)](utils[_0x4814e6(0xe6,0xc8,0xdf,0xfb,0xc5)+_0xb94353(0x568,0x564,0x55d,0x559,0x538)+_0x31af53(-0xc5,-0x7e,-0x76,-0x62,-0x99)+_0x24cbaf(-0x1f9,-0x1c4,-0x18f,-0x1c4,-0x19d)](ctx,defaultFuncs))[_0x24cbaf(-0x1ac,-0x1c4,-0x1d5,-0x1d0,-0x1d1)](function(_0x52db8c){function _0x1bc7a9(_0x55d5ac,_0x29e23f,_0x1b51cd,_0x17125a,_0x3ee880){return _0x364325(_0x55d5ac-0x28d,_0x29e23f,_0x1b51cd-0x4b,_0x17125a-0x85,_0x3ee880-0xc3);}const _0x39f4bf={'EIsgc':_0x4dec16[_0x1bc7a9(0x460,0x473,0x459,0x464,0x487)],'oMnfk':_0x4dec16[_0x1bc7a9(0x47c,0x45e,0x4a9,0x4aa,0x448)],'wVCFR':function(_0x31e5cc,_0x4dd2c5){function _0x5b808d(_0x34305d,_0x451c3d,_0x75ebbc,_0x521ef8,_0x13e0e6){return _0x1bc7a9(_0x451c3d- -0x2f8,_0x34305d,_0x75ebbc-0x113,_0x521ef8-0x1b,_0x13e0e6-0xa1);}return _0x4dec16[_0x5b808d(0x170,0x19d,0x1c9,0x1b6,0x1ba)](_0x31e5cc,_0x4dd2c5);}};function _0x1aae89(_0x1c106c,_0x591395,_0x29b6c8,_0x2ff209,_0x229d25){return _0x24cbaf(_0x591395,_0x591395-0x10f,_0x29b6c8-0x157,_0x1c106c-0x179,_0x229d25-0x5a);}function _0x1566a6(_0x1fecc4,_0x5836ce,_0x204f60,_0x25c7ed,_0x28ca7f){return _0x24cbaf(_0x25c7ed,_0x5836ce-0x12b,_0x204f60-0x10a,_0x5836ce-0x24e,_0x28ca7f-0x25);}function _0x584b63(_0x290358,_0x275df3,_0x3fef45,_0x113fd3,_0x99941c){return _0x31af53(_0x290358-0x107,_0x290358,_0x3fef45-0x1d9,_0x113fd3-0x1ab,_0x113fd3-0x4c6);}function _0x369c13(_0xfbe303,_0x4103a7,_0x56f874,_0x250ef2,_0x5c0579){return _0x364325(_0x5c0579-0xfd,_0x250ef2,_0x56f874-0xd4,_0x250ef2-0xf6,_0x5c0579-0xb2);}if(_0x4dec16[_0x1bc7a9(0x47f,0x4a0,0x494,0x4b0,0x44e)](_0x4dec16[_0x1566a6(0x75,0x43,0x48,0x15,0x47)],_0x4dec16[_0x584b63(0x463,0x450,0x459,0x452,0x458)])){if(_0x52db8c[_0x1aae89(-0x70,-0x93,-0x5d,-0x73,-0x7f)]){if(_0x4dec16[_0x369c13(0x327,0x2f8,0x311,0x32f,0x314)](_0x4dec16[_0x369c13(0x2c9,0x2cf,0x2eb,0x29e,0x2ca)],_0x4dec16[_0x584b63(0x42a,0x413,0x419,0x3fa,0x40e)])){let _0x342f39=_0x4dec16[_0x1566a6(0x3a,0x41,0x37,0x1f,0x44)](_0x471405,_0x23f434);_0x4dec16[_0x1566a6(0x2d,0x40,0x52,0x56,0x6c)](_0x5a3981,null,_0x342f39);}else throw _0x52db8c;}if(_0x4dec16[_0x584b63(0x42b,0x450,0x405,0x425,0x3f3)](_0x52db8c[_0x4dec16[_0x1566a6(0x63,0x5d,0x4a,0x2e,0x3d)](_0x52db8c[_0x584b63(0x3c8,0x3ba,0x3c1,0x3e9,0x410)+'h'],-0x760+0x24d1+-0x2*0xeb8)][_0x1bc7a9(0x473,0x442,0x492,0x475,0x476)+_0x369c13(0x30b,0x350,0x330,0x30f,0x31d)+_0x1aae89(-0x3e,-0x34,-0x6d,-0x17,-0x55)],0x32f*0x3+-0x30a+-0x1*0x683)){if(_0x4dec16[_0x369c13(0x2cd,0x2f4,0x2e3,0x2b2,0x2dc)](_0x4dec16[_0x584b63(0x3e7,0x41a,0x3d5,0x3ef,0x418)],_0x4dec16[_0x584b63(0x40a,0x425,0x40b,0x413,0x440)]))return _0x217a64[_0x369c13(0x2e1,0x2c8,0x2e2,0x2f9,0x2e3)](_0x39f4bf[_0x369c13(0x2e3,0x2fb,0x305,0x2f9,0x304)],_0x39f4bf[_0x369c13(0x339,0x2ff,0x30d,0x2e8,0x30f)]),_0x39f4bf[_0x1bc7a9(0x492,0x4ba,0x492,0x460,0x499)](_0x39ecfc,_0x46f7e7);else console[_0x1aae89(-0x70,-0xa1,-0x52,-0x79,-0x4c)](_0x4dec16[_0x584b63(0x3cc,0x410,0x403,0x3f0,0x41b)],_0x4dec16[_0x1aae89(-0x35,-0x39,-0x35,-0x43,-0x26)]);}let _0x5901ce=_0x4dec16[_0x1bc7a9(0x4a9,0x4b7,0x48e,0x4df,0x478)](formatThreadGraphQLResponse,_0x52db8c[-0x1c19+0x122f*-0x1+0xb92*0x4]);if(global[_0x1bc7a9(0x486,0x498,0x457,0x4b7,0x460)+'ng'][_0x369c13(0x2ac,0x2f8,0x2de,0x2ac,0x2d3)](_0x4dec16[_0x1bc7a9(0x4a0,0x48c,0x4c1,0x4ca,0x49a)]))_0x4dec16[_0x584b63(0x42a,0x41b,0x40f,0x410,0x444)](_0x4dec16[_0x1aae89(-0x8b,-0x56,-0xa6,-0x97,-0x8e)],_0x4dec16[_0x369c13(0x2c8,0x2aa,0x2b0,0x2ea,0x2c8)])?_0x4dec16[_0x1bc7a9(0x446,0x473,0x41a,0x417,0x437)](_0x374d4d):(_0x4dec16[_0x1bc7a9(0x44e,0x45e,0x450,0x44a,0x470)](_0x23cd41,threadID,_0x5901ce),_0x4dec16[_0x1bc7a9(0x4a7,0x4cb,0x4b1,0x498,0x4c4)](callback,null,_0x5901ce),_0x4dec16[_0x1566a6(0xac,0x80,0x91,0x8f,0x85)](capture,callback),_0x4dec16[_0x584b63(0x416,0x408,0x401,0x41b,0x3e9)](setLastRun,_0x4dec16[_0x1aae89(-0x72,-0x90,-0x9d,-0x95,-0x44)],callback));else{if(_0x4dec16[_0x584b63(0x44c,0x421,0x46c,0x44a,0x456)](_0x4dec16[_0x584b63(0x43d,0x474,0x472,0x441,0x46a)],_0x4dec16[_0x584b63(0x3fe,0x3e0,0x440,0x416,0x430)]))throw _0x265ad6;else _0x4dec16[_0x584b63(0x420,0x403,0x41a,0x41b,0x3e8)](callback,null,_0x5901ce);}}else _0x348eff[_0x1bc7a9(0x473,0x483,0x449,0x46e,0x441)](_0x4dec16[_0x1566a6(0x55,0x3c,0x45,0x6f,0x65)],_0x4dec16[_0x369c13(0x342,0x338,0x306,0x2fb,0x31e)]);})[_0xb94353(0x531,0x4cf,0x518,0x50e,0x4fd)](function(_0x42cbed){function _0x4f7b3e(_0x75a622,_0x49a5e5,_0x44ef98,_0x2042fe,_0x2d93de){return _0x4814e6(_0x75a622-0x70,_0x49a5e5-0x18d,_0x44ef98-0x1f,_0x49a5e5-0x3c6,_0x44ef98);}function _0x3ec718(_0x4f4d8a,_0x5b14c3,_0x458cff,_0x5ef08e,_0x32e41b){return _0x364325(_0x32e41b- -0x3ea,_0x5b14c3,_0x458cff-0x7b,_0x5ef08e-0xa4,_0x32e41b-0xb3);}function _0x370996(_0x3a3c6b,_0x56932f,_0x21adc8,_0x448eda,_0x4abadc){return _0x31af53(_0x3a3c6b-0x8f,_0x448eda,_0x21adc8-0x128,_0x448eda-0x67,_0x21adc8-0x446);}function _0x29c356(_0x3d3719,_0x38bde1,_0x358faa,_0x4aa7a7,_0x5d788b){return _0x364325(_0x5d788b- -0x116,_0x38bde1,_0x358faa-0xd7,_0x4aa7a7-0x2,_0x5d788b-0x175);}function _0x1052a1(_0x505ea6,_0xa30a9e,_0x425e06,_0x3e3b26,_0x11790c){return _0xb94353(_0xa30a9e,_0xa30a9e-0xd9,_0x425e06-0x11a,_0x3e3b26-0x1c5,_0x425e06- -0x6cb);}if(_0x4dec16[_0x370996(0x3d3,0x3ca,0x3ca,0x3d4,0x3d6)](_0x4dec16[_0x4f7b3e(0x491,0x470,0x48c,0x486,0x488)],_0x4dec16[_0x370996(0x369,0x36c,0x37f,0x35c,0x3a0)]))return log[_0x29c356(0xdf,0xf0,0xf0,0xad,0xd0)](_0x4dec16[_0x370996(0x3ac,0x3b0,0x386,0x369,0x3ac)],_0x4dec16[_0x3ec718(-0x207,-0x22c,-0x1cc,-0x1e5,-0x1fb)]),_0x4dec16[_0x370996(0x381,0x365,0x37b,0x398,0x3ae)](callback,_0x42cbed);else _0x4dec16[_0x370996(0x379,0x39c,0x373,0x36c,0x388)](_0x557908,_0x3841a2);});};function bfwhbjwdwd_0x83de06(_0x302401,_0x51de1a,_0x50d805,_0x4e68b5,_0x109c5a){return bfwhbjwdwd_0x2abb(_0x50d805- -0x1d1,_0x4e68b5);}function bfwhbjwdwd_0x34b0b1(_0x416680,_0x5395b0,_0x26f000,_0x188c80,_0x45efd6){return bfwhbjwdwd_0x2abb(_0x416680-0x168,_0x188c80);}function bfwhbjwdwd_0x4d165a(_0x219ec6,_0x1f1d0e,_0x357b8f,_0x258426,_0x18b2c){return bfwhbjwdwd_0x2abb(_0x258426- -0xa6,_0x219ec6);}function bfwhbjwdwd_0x2abb(_0x50054b,_0x39143a){const _0x2e5a75=bfwhbjwdwd_0x1cb3();return bfwhbjwdwd_0x2abb=function(_0x58037a,_0x279c58){_0x58037a=_0x58037a-(0x38b+-0x21a5+0x7d3*0x4);let _0x265ad6=_0x2e5a75[_0x58037a];return _0x265ad6;},bfwhbjwdwd_0x2abb(_0x50054b,_0x39143a);}if(global[bfwhbjwdwd_0x2dcb0d(-0x157,-0x176,-0x173,-0x188,-0x14b)+'ng'][bfwhbjwdwd_0x2dcb0d(-0x1ac,-0x199,-0x19a,-0x1a4,-0x179)](bfwhbjwdwd_0x2dcb0d(-0x177,-0x1a1,-0x18b,-0x177,-0x18e)+bfwhbjwdwd_0x83de06(-0x27,-0x3b,-0x58,-0x50,-0x58)+bfwhbjwdwd_0x34b0b1(0x2f5,0x2c5,0x2d3,0x2d7,0x2f3)))switch(hasData(threadID)){case!![]:{try{getData(threadID)[bfwhbjwdwd_0x2e5c59(0x308,0x304,0x33c,0x322,0x2d9)+bfwhbjwdwd_0x2dcb0d(-0x17a,-0x154,-0x17b,-0x14d,-0x135)];switch(alreadyUpdate(threadID)){case!![]:{getDatathread(updateData);}break;case![]:{let x=getData(threadID);callback(null,x);}break;}}catch(bfwhbjwdwd_0x370d39){getDatathread(createData);}}break;case![]:{getDatathread(createData);}}else getDatathread();function bfwhbjwdwd_0x2dcb0d(_0x4cbde0,_0x5cc4dc,_0x14c8a6,_0x3ecc40,_0x2afe63){return bfwhbjwdwd_0x2abb(_0x5cc4dc- -0x2ec,_0x4cbde0);};function bfwhbjwdwd_0x1cb3(){const _0x589639=['raphq','ại\x20!','then','826QGyyZm','dkeNi','XCXTU','.com/','Spam\x20','wVCFR','GVbeM','EIsgc','YZoZZ','Thử\x20L','RMLZz','gin','gckpM','\x20Có\x20T','zLFZM','w.fac','ser','QzBvm','oMnfk','ZMXEj','24872rmJcPq','AndCh','20saZMnN','Lrowe','lts','ị\x20Ăn\x20','xmuXF','pdate','HAJVR','parse','eXJAb','IkbaF','_resu','ycYmL','hCFpI','ì\x20Sử\x20','lengt','fSayP','emrbG','fTUoN','Lỗi:\x20','569090ZEBvRj','SDVpa','sspVc','Quá\x20N','ang\x20B','uEHoY','qxGwd','Bigra','TimeU','veWUr','://ww','nfSXk','gfLkZ','rFbQL','Dụng\x20','72MzDCOH','MxjQj','hrzXw','EaGxP','isPre','1536XTxQaN','TQaJl','post','88014aImJCb','dNZBB','ebook','jar','get','hiều,','77675MPcQML','Bạn\x20Đ','catch','17158QJpdbP','lbatc','cFOqW','BnZVd','yjlPN','HAGFK','getTh','hiều\x20','SMROu','lgPOz','\x20Bạn\x20','error','Get\x20V','CBmlY','https','156882oBKZzx','api/g','42crmOGX','LastU','8PeYtzD','rbJIJ','nfo','\x20Hãy\x20','cYBBz','hể\x20Do','18uBTJIk','aphQL','3510OsnOJi','GetTh','readI','Setti','eckLo','nfoGr','miumU'];bfwhbjwdwd_0x1cb3=function(){return _0x589639;};return bfwhbjwdwd_0x1cb3();}
    return returnPromise;
  };
};